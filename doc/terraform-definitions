ğŸ“„ DocumentaÃ§Ã£o â€” DecisÃµes sobre o uso de Terraform

ğŸ¯ Contexto

Com a evoluÃ§Ã£o das operaÃ§Ãµes no Uruguai, iniciamos a definiÃ§Ã£o da estratÃ©gia para gestÃ£o de infraestrutura como cÃ³digo (IaC) utilizando Terraform, considerando a realidade local e aprendizados do Brasil.

Inicialmente, pensamos em replicar o modelo brasileiro: um repositÃ³rio por mÃ³dulo, onde cada recurso ou componente principal teria seu prÃ³prio repositÃ³rio dedicado, incluindo todos os subcomponentes necessÃ¡rios.

Essa abordagem funciona bem em empresas com equipes grandes e times com autonomia total sobre sua infraestrutura. No Uruguai, concluÃ­mos que o cenÃ¡rio Ã© diferente.

ğŸ’¬ DiscussÃµes e mudanÃ§a de direÃ§Ã£o

ApÃ³s conversas com o time de Infraestrutura e o time de The Voice, percebemos que:

O time local Ã© pequeno (4 membros de Infra/DevOps).

NÃ£o existem squads autÃ´nomos; toda a gestÃ£o de infraestrutura fica centralizada.


Optamos entÃ£o por usar um repositÃ³rio Ãºnico por conta de produto, centralizando todos os recursos e mÃ³dulos necessÃ¡rios. Isso simplifica governanÃ§a, manutenÃ§Ã£o e libera o time para melhorias.

ğŸ—‚ï¸ Estrutura atual definida

RepositÃ³rio Ãºnico por conta de produto.

OrganizaÃ§Ã£o interna em mÃ³dulos.

Exemplo: EC2, S3, Fargate, roles e VPCs no mesmo repositÃ³rio.


âœ… Tabela de prÃ³s e contras â€” MÃ³dulos em repositÃ³rios separados vs. Ãºnicos

CritÃ©rio	Separados por mÃ³dulo	RepositÃ³rio Ãºnico

Autonomia por time	Alta	Baixa, gestÃ£o centralizada
Escalabilidade organizacional	Alta	Limitada, mas suficiente
ManutenÃ§Ã£o	Complexa	Simples
Controle de deploy	Mais granular	Centralizado
Velocidade de ajustes	Alta	Mais controlada
GovernanÃ§a	Mais robusta	Mais simples


âœ… Tabela de prÃ³s e contras â€” Separados por recurso vs. Ãºnico por conta

CritÃ©rio	Separados por recurso	Ãšnico por conta

Isolamento	Total	Baixo
VisÃ£o geral do ambiente	Fragmentada	Consolidada
GovernanÃ§a de secrets	Complexa	Centralizada
Complexidade CI/CD	Alta	Baixa
DependÃªncias	Complexas	Mais simples
Escalabilidade futura	Boa	Pode precisar ajuste


ğŸ’¡ DecisÃ£o final

RepositÃ³rio Ãºnico por conta de produto.

OrganizaÃ§Ã£o interna em mÃ³dulos.

Pipelines e governanÃ§a simplificados.

RevisÃ£o periÃ³dica futura.


ğŸš€ PrÃ³ximos passos

Documentar estrutura de diretÃ³rios.

Configurar pipelines (OIDC e workflows).

AprovaÃ§Ãµes manuais para produÃ§Ã£o.

Criar guias internos.


âœï¸ ConclusÃ£o

A estratÃ©gia atual Ã© baseada no tamanho do time, simplicidade e visÃ£o consolidada. A documentaÃ§Ã£o serÃ¡ viva e revisada conforme evoluÃ§Ã£o.


---

ğŸ—’ï¸ Template README.md sugerido

# ğŸš€ Nome do RepositÃ³rio

## ğŸ“„ DescriÃ§Ã£o

RepositÃ³rio Terraform para a conta **<nome_da_conta>**. Inclui EC2, S3, Fargate, roles, VPCs e outros recursos.

## ğŸ—ï¸ Estrutura

.
â”œâ”€â”€ main.tf
â”œâ”€â”€ variables.tf
â”œâ”€â”€ outputs.tf
â”œâ”€â”€ versions.tf
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ ec2/
â”‚   â”œâ”€â”€ s3/
â”‚   â”œâ”€â”€ fargate/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ environments/
â”‚   â”œâ”€â”€ dev/
â”‚   â”œâ”€â”€ staging/
â”‚   â””â”€â”€ prod/
â””â”€â”€ README.md

## âš™ï¸ Deploy

```bash
terraform init
tf fmt -recursive
tf validate
tf plan -var-file="environments/dev/dev.tfvars"
tf apply -var-file="environments/dev/dev.tfvars"

ğŸ” SeguranÃ§a

AutenticaÃ§Ã£o OIDC via GitHub Actions.

PermissÃµes mÃ­nimas.


ğŸ‘¨â€ğŸ’» ContribuiÃ§Ã£o

1. Crie uma branch.


2. FaÃ§a alteraÃ§Ãµes.


3. Abra Pull Request.


4. Aguarde revisÃ£o.



ğŸ“ ObservaÃ§Ãµes

MudanÃ§as em prod precisam de aprovaÃ§Ã£o manual.

Seguir guias internos.


ğŸ“ Contato

Time Infra/DevOps â€” <contato>

Pronto para exportar em `.md` e subir no Git!

